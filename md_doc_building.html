<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ipfs-chromium: Install CMake 3.22+</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ipfs-chromium
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Install CMake 3.22+ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Before proceeding with any combination of the steps below, make sure you have in your PATH:</p><ul>
<li>CMake version 3.22 or higher<ul>
<li>run <code>cmake --version</code> to check</li>
<li>If your system's preferred way to install software has only an older version, consider <a href="https://cmake.org/install/">these instructions</a></li>
</ul>
</li>
<li>Python 3.6+ and its pip</li>
<li>git</li>
</ul>
<p>Then decide which of these approaches are appropriate for you:</p>
<h1><a class="anchor" id="autotoc_md10"></a>
ipfs_client (without Chromium)</h1>
<p>Found in the library/ directory, ipfs_client is a library with a fairly standard <a href="https://cmake.org/cmake/help/latest/">CMake</a> build.</p>
<p>As for dependencies, you have some choices:</p>
<h2><a class="anchor" id="autotoc_md11"></a>
With Python</h2>
<p>If you have python3 and installed and findable, it will use <a href="https://docs.conan.io/en/latest/introduction.html">Conan</a> to manage dependencies.</p>
<p>See also: docker/debian-python</p>
<h2><a class="anchor" id="autotoc_md12"></a>
With C++23 (standard library in particular, but assuming the compiler too)</h2>
<p>Be sure to set CXX_VERSION=23 in the CMake configure step. This covers your need for 'vocabulary types', so you shouldn't need Boost or Abseil. Otherwise, follow the next subsection.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
With system-installed or otherwise CMake-findable dependencies</h2>
<p>Required dependencies as they exist today:</p><ul>
<li>protobuf (both compiler and library)</li>
<li>OpenSSL - TODO probably should de-require, easiest path is disabling sha at runtime. Also, alternatives.</li>
<li>vocabulary types: one of the following<ul>
<li>boost (See also: docker/debian-boost)</li>
<li>abseil &amp; boost (will prefer Abseil, fills in gap with boost)</li>
</ul>
</li>
</ul>
<p>To enable testing, these are also required:</p><ul>
<li>GTest</li>
<li>GMock</li>
</ul>
<h2><a class="anchor" id="autotoc_md14"></a>
Steps</h2>
<ul>
<li><code>mkdir -p /your/build/dir</code></li>
<li><code>cmake -D CMAKE_BUILD_TYPE=Debug -S /path/to/ipfs-chromium -B /your/build/dir</code><ul>
<li>Set CMAKE_BUILD_TYPE to one of Debug or Release.</li>
<li>Specifying the generator (with -G) is optional, but I recommend picking one that knows about compile_commands.json. You do, obviously, need to pick one that you have installed. See the end of the output from <code>cmake --help</code> to see which ones you have available</li>
</ul>
</li>
<li>Expect warnings about how it doesn't have access to a Chromium source tree and so won't be building that.</li>
<li><code>cmake --build /your/build/dir --target ipfs_client</code><ul>
<li>Or invoke your underlying build system directly, with make or ninja, or what have you.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md15"></a>
Chromium with the ipfs component</h1>
<h2><a class="anchor" id="autotoc_md16"></a>
If you already have a "chrome" build available on your system you'd like to patch with IPFS</h2>
<h3><a class="anchor" id="autotoc_md17"></a>
Pre-steps</h3>
<ul>
<li>See <a href="https://chromium.googlesource.com/chromium/src/+/main/docs/linux/build_instructions.md">the docs</a> explaining these steps.</li>
<li>You already did the fetch &amp; runhooks</li>
<li>You already have a build directory (e.g. out/Default) via gn gen</li>
<li>You have a handful of targets already built (TODO: get a specific list).<ul>
<li>These are all dependencies of chrome, so if you've built chrome you're good.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md18"></a>
Steps (TODO - finish docker)</h3>
<ul>
<li><code>mkdir -p /an/ipfs-chromium/build/dir</code></li>
<li><code>cmake -D CMAKE_BUILD_TYPE=Debug -D CHROMIUM_SOURCE_TREE=/your/checkout/chromium/src -D CHROMIUM_PROFILE=Default -S /path/to/ipfs-chromium -B /an/ipfs-chromium/build/dir</code><ul>
<li>CMAKE_BUILD_TYPE - Either Debug or Release. Choose Debug unless you use is_debug=false in args.gn.</li>
<li>CHROMIUM_SOURCE_TREE - points to the git checkout of chromium. Should end in /src</li>
<li>CHROMIUM_PROFILE - the profile you're building. Defaults to ${CMAKE_BUILD_TYPE}. ${CHROMIUM_SOURCE_TREE}/out/${CHROMIUM_PROFILE} should exist.</li>
<li>DEPOT_TOOLS_DIRECTORY - Path to scripts like gn, autoninja, and ninja.py. If these are executable and in your <code>PATH</code> environment variable, you can leave this as its default value which is "DETECT_FROM_PATH" and does what one might expect.</li>
<li>If ipfs is not mentioned in //chrome/browser/BUILD.gn , this command will apply the patch file presumably adding //components/ipfs as a dependency to //chrome/browser</li>
</ul>
</li>
<li><code>cmake --build /an/ipfs-chromium/build/dir --target build_browser</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md19"></a>
If you want ipfs-chromium's build do all your setup for you.</h2>
<p>If you take this approach, ipfs-chromium will download a private copy of the Chromium source tree and depot_tools into its own build directory.</p>
<p><em>NOTE</em> This takes a long time, about 55GB of disk space, and a fair bit of memory.</p>
<p><em>NOTE</em> The previous section assumes you must have gotten all the dependencies of Chromium, because if you had not you wouldn't have successfully built chrome. However, here we cannot make that assumption. So...</p>
<h3><a class="anchor" id="autotoc_md20"></a>
Steps</h3>
<ul>
<li><code>mkdir -p /an/ipfs-chromium/build/dir</code></li>
<li><code>cmake -D CMAKE_BUILD_TYPE=Release -D DOWNLOAD_CHROMIUM=TRUE -S /path/to/ipfs-chromium -B /an/ipfs-chromium/build/dir</code><ul>
<li>CMAKE_BUILD_TYPE - Either Debug or Release. If you choose Release it will set is_debug=false in args.gn.</li>
<li>If <code>ccache</code> is in your path, it will instruct not just the CMake but also the gn build to use it. I recommend this.</li>
<li>This step will take much longer than you may be used to as a normal CMake user.</li>
</ul>
</li>
<li>Make sure you have Chromium's dependencies<ul>
<li><a href="https://chromium.googlesource.com/chromium/src/+/main/docs/linux/build_instructions.md#Install-additional-build-dependencies">Linux</a><ul>
<li>The script <code>install-build-deps.sh</code> mentioned in those instructions will be downloaded for you if you build the target <code>setup_component</code> e.g. <code>cmake --build /an/ipfs-chromium/build/dir --target setup_component</code>. Ignore failure at this point, then look for your script in: <code>/an/ipfs-chromium/build/dir/chromium/src/build/install-build-deps.sh</code></li>
<li>The author is writing this on Fedora, where the not-guaranteed <a href="https://chromium.googlesource.com/chromium/src/+/main/docs/linux/build_instructions.md#Fedora">note</a> seems to work fine.</li>
<li>If your system isn't supported by install-build-deps.sh, and doesn't have a functioning 'note' on that document, I suggest looking at the package lists from the other distros' notes to get an idea of what is actually needed. -<a href="https://chromium.googlesource.com/chromium/src/+/main/docs/mac_build_instructions.md#System-requirements">Mac</a></li>
<li>Make any necessary upgrades/installations to meet the "System Requirements" mentioned in the doc. -<a href="https://chromium.googlesource.com/chromium/src/+/main/docs/windows_build_instructions.md#Setting-up-Windows">Windows</a></li>
<li>Make any upgrades/installations mentioned in the "Setting up Windows" section mentioned in the doc that you don't already have.</li>
<li>Note: building on Windows isn't fully tested. Our released Windows builds were cross-compiled.</li>
</ul>
</li>
</ul>
</li>
<li><code>cmake --build /an/ipfs-chromium/build/dir --target build_browser</code><ul>
<li>This will take much, much longer than you're used to.</li>
</ul>
</li>
<li>At this point you should be able to run the binary. If you used the above command it could be found at: /an/ipfs-chromium/build/dir/chromium/src/out/Debug/chrome</li>
<li>To put a bow on it, you could <code>ninja package_browser</code>.<ul>
<li>package_browser doesn't work properly on Windows.</li>
</ul>
</li>
</ul>
<p><em>NOTE</em> - anwhere in this document you see <code>cmake --build</code>, feel free to replace that with a call to your chosen underlying build system. For example, <code>cmake --build X Y</code> could become <code>make -C X Y</code> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
