<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ipfs-chromium: blinkon23</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ipfs-chromium
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">blinkon23 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md42"></a>
Content-Verifying IPFS Client in Chromium</h1>
<table style="margin-left:auto;margin-right:auto;">
<tr>
<td colspan="2"><p class="starttd"></p>
<p class="endtd"><img src="chromium.png" alt="Chromium" class="inline"/> </p>
</td><td colspan="2"><p class="starttd"></p>
<p class="intertd"><img src="ipfs.png" alt="IPFS" class="inline"/> </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><p class="starttd"></p>
<p class="endtd"><img src="lbl.png" alt="LBL" class="inline"/> </p>
</td><td><p class="starttd"></p>
<p class="endtd"><img src="arc.png" alt="arc" class="inline"/> </p>
</td><td><p class="starttd"></p>
<p class="endtd"><img src="fil.png" alt="FIL" class="inline"/> </p>
</td><td><p class="starttd"></p>
<p class="endtd"><img src="pl.png" alt="PL" class="inline"/> </p>
</td></tr>
</table>
<h2><a class="anchor" id="autotoc_md43"></a>
What is IPFS?</h2>
<ul>
<li>Content-addressed: pulling from a DHT &amp; verifying</li>
<li>Distributed: agnostic to which gateway/node provided</li>
</ul>
<table border="0">
<tr>
<td style="background-color: #DFDAFF; font-size: 15px;"><p class="starttd"></p>
<p class="endtd"></p>
</td></tr>
</table>
<h4><a class="anchor" id="autotoc_md44"></a>
Some of the IPFS Ecosystem</h4>
<ul>
<li>Brave</li>
<li>IPFS Companion extension</li>
<li>curl</li>
<li>js-ipfs-core</li>
<li>kubo</li>
<li>lassie</li>
<li>bifrost </li>
</ul>
<p><img src="back.png" alt="" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md45"></a>
URL Schemes</h2>
<ul>
<li>ipfs://bafybeidjtwun7gvpfjymhquloxzzwhpctgsw3vxampxr46du2we4yhiqje/reference/en/index.html<ul>
<li>Refers to immutable content/site</li>
<li>Origin contains hash for root of Merkle tree</li>
</ul>
</li>
<li>ipns://k51qzi5uqu5dijv526o4z2z10ejylnel0bfvrtw53itcmsecffo8yf0zb4g9gi/links.html<ul>
<li>Mutable pointer to immutable data</li>
<li>Origin contains public key to verify the 'pointer' record</li>
</ul>
</li>
<li>ipns://en.wikipedia-on-ipfs.org/wiki/Book<ul>
<li>DNSLink uses DNS TXT records to redirect to /ipns/ or /ipfs/</li>
<li>Origin contains hostname</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md46"></a>
Let's step through loading a page</h2>
<p>&lt;script type="module"&gt; import mermaid from '<a href="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';">https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';</a> mermaid.initialize({ startOnLoad: true }); &lt;/script&gt;</p>
<h3><a class="anchor" id="autotoc_md47"></a>
User enters URL</h3>
<p>ipns://k51qzi5uqu5dku8zqce3b7kmpcw6uua9w00b5boyaevowmzls2rpie0itokett/ </p><div class="mermaid"> flowchart LR; ipns["/ipns/k51qzi5uqu5dku8zqce3b7kmpcw6uua9w00b5boyaevowmzls2rpie0itokett"] style ipns fill:#f9f </div><h3><a class="anchor" id="autotoc_md48"></a>
Request IPNS Record</h3>
<p><a href="http://localhost:8080/ipns/k51qzi5uqu5dku8zqce3b7kmpcw6uua9w00b5boyaevowmzls2rpie0itokett?format=ipns-record">http://localhost:8080/ipns/k51qzi5uqu5dku8zqce3b7kmpcw6uua9w00b5boyaevowmzls2rpie0itokett?format=ipns-record</a> Returns: <code>Content-Type: application/vnd.ipfs.ipns-record</code> Body (protobuf) contains: </p><div class="fragment"><div class="line">Value:         &quot;/ipns/ipfs.tech&quot;</div>
<div class="line">... snip ...</div>
<div class="line">Signature V2:  &quot;mKWg7Jv/T+7hhKE1d/9YY7JHWeAaBJ/yQI3C56xn5v7ld9MZO2InUIGE0vSpW+ZRw3nNMJJT+usye8Tt2GRqpCw&quot;</div>
<div class="line">Data:          {&quot;Sequence&quot;:0,&quot;TTL&quot;:60000000000,&quot;Validity&quot;:{&quot;/&quot;:{&quot;bytes&quot;:&quot;MjAyMy0wOS0yOFQxMzo0MDoyMS4xMzI1NDQwMDFa&quot;}},&quot;ValidityType&quot;:0,&quot;Value&quot;:{&quot;/&quot;:{&quot;bytes&quot;:&quot;L2lwbnMvaXBmcy50ZWNo&quot;}}}</div>
</div><!-- fragment --><p> Verify signature and continue. </p><div class="mermaid"> flowchart LR; ipns["/ipns/k51...ett"]--&gt;dnsl["/ipns/ipfs.tech"] style ipns fill:#f9f style dnsl fill:#fa9 </div><h3><a class="anchor" id="autotoc_md49"></a>
DNS TXT Record Lookup</h3>
<p>_dnslink.ipfs.tech has TXT "dnslink=/ipfs/QmRE3dyFsbhC1dAthPBvgo4w15dGwppCAybgmJDB5m2SRy" </p><div class="mermaid"> flowchart LR; ipns["/ipns/k51...ett"]--&gt;dnsl["/ipns/ipfs.tech"]--&gt;root["/ipfs/QmR...2SRy"] style ipns fill:#f9f style dnsl fill:#fa9 </div><h3><a class="anchor" id="autotoc_md50"></a>
We have our immutable content</h3>
<p>Request the root node in a verifiable format (see <a href="https://specs.ipfs.tech/http-gateways/trustless-gateway/">https://specs.ipfs.tech/http-gateways/trustless-gateway/</a>)</p>
<p><a href="https://ipfs.io/ipfs/QmRE3dyFsbhC1dAthPBvgo4w15dGwppCAybgmJDB5m2SRy?format=raw">https://ipfs.io/ipfs/QmRE3dyFsbhC1dAthPBvgo4w15dGwppCAybgmJDB5m2SRy?format=raw</a> Returns <code>Content-Type: application/vnd.ipld.raw</code> directory with 26 entries. Verify the hash matches and continue. </p><div class="mermaid"> flowchart LR; ipns["/ipns/k51...ett"]--&gt;dnsl["/ipns/ipfs.tech"]--&gt;root["/ipfs/QmR...2SRy"] style ipns fill:#f9f style dnsl fill:#fa9 root--&gt;e1["..."] root--&gt;nuxt["_nuxt = QmYpxEzdbNbohung4gQoZFoQEzLNeBT8oGCQGPtKgjDbnT"] root--&gt;e3["..."] root--&gt;index["index.html = QmTzVjzGMG4LwBY9ArxcNcokPfbpG2biT8Gy9AiecxKtju"] root--&gt;e5["..."] style root fill:#9fb </div><h3><a class="anchor" id="autotoc_md51"></a>
The directory that contains index.html, so request that</h3>
<p><a href="https://gateway.pinata.cloud/ipfs/QmTzVjzGMG4LwBY9ArxcNcokPfbpG2biT8Gy9AiecxKtju?format=raw">https://gateway.pinata.cloud/ipfs/QmTzVjzGMG4LwBY9ArxcNcokPfbpG2biT8Gy9AiecxKtju?format=raw</a> Or set header <code>Accept: application/vnd.ipld.raw</code> instead of format parameter. Note the recursive verification. </p><div class="mermaid"> flowchart LR; ipns["/ipns/k51...ett"]--&gt;dnsl["/ipns/ipfs.tech"]--&gt;root["/ipfs/QmR...2SRy"] style ipns fill:#f9f style dnsl fill:#fa9 root--&gt;e1["..."] root--&gt;nuxt["_nuxt = QmYpxEzdbNbohung4gQoZFoQEzLNeBT8oGCQGPtKgjDbnT"] root--&gt;e3["..."] root--&gt;index["index.html = QmTzVjzGMG4LwBY9ArxcNcokPfbpG2biT8Gy9AiecxKtju"] root--&gt;e5["..."] style root fill:#9fb style index fill:#9fb </div><h3><a class="anchor" id="autotoc_md52"></a>
index.html fits into a single block</h3>
<p>So just deserialize and return its content. The HTML starts rendering, and requests a resource. <code>&lt;img style="" class="max-w-40 mx-auto" src="/_nuxt/ipfs-logo.a313bcee.svg" data-v-6d12c5c1&gt;</code> This is relative to the ipns root, so start over with a request for: <code>ipns://k51qzi5uqu5dku8zqce3b7kmpcw6uua9w00b5boyaevowmzls2rpie0itokett/_nuxt/ipfs-logo.a313bcee.svg</code></p>
<h3><a class="anchor" id="autotoc_md53"></a>
Lots of stuff is in hot in cache. Requesting the entry _nuxt:</h3>
<p><a href="https://ipfs.joaoleitao.org/QmYpxEzdbNbohung4gQoZFoQEzLNeBT8oGCQGPtKgjDbnT?format=raw">https://ipfs.joaoleitao.org/QmYpxEzdbNbohung4gQoZFoQEzLNeBT8oGCQGPtKgjDbnT?format=raw</a> </p><div class="mermaid"> flowchart LR; ipns["/ipns/k51...ett"]--&gt;dnsl["/ipns/ipfs.tech"]--&gt;root["/ipfs/QmR...2SRy"] style ipns fill:#f9f style dnsl fill:#fa9 root["/ipfs/QmR...SRy"] root--&gt;e1["..."] root--&gt;nuxt["_nuxt = QmY...bnT"] root--&gt;e3["..."] root--&gt;index["index.html = QmT...tju"] root--&gt;e5["..."] style root fill:#9fb style index fill:#9fb </div><h3><a class="anchor" id="autotoc_md54"></a>
_nuxt is also a directory, with 164 entries</h3>
<p>Request the file we're after. <a href="https://ipfs.fleek.co/ipfs/QmWTW21hadJGoAcmGZC18mCFq71UUVGPtJSX5PeBubnQCQ?format=raw">https://ipfs.fleek.co/ipfs/QmWTW21hadJGoAcmGZC18mCFq71UUVGPtJSX5PeBubnQCQ?format=raw</a> </p><div class="mermaid"> flowchart LR; ipns["/ipns/k51...ett"]--&gt;dnsl["/ipns/ipfs.tech"]--&gt;root["/ipfs/QmR...2SRy"] style ipns fill:#f9f style dnsl fill:#fa9 root["/ipfs/QmR...SRy"] root--&gt;e1["..."] root--&gt;nuxt["_nuxt = QmY...bnT"] root--&gt;e3["..."] root--&gt;index["index.html = QmT...tju"] root--&gt;e5["..."] nuxt--&gt;f0["..."] nuxt--&gt;img["ipfs-logo.a313bcee.svg = QmWTW21hadJGoAcmGZC18mCFq71UUVGPtJSX5PeBubnQCQ"] nuxt--&gt;f1["..."] style root fill:#9fb style index fill:#9fb style nuxt fill:#9fb </div><h3><a class="anchor" id="autotoc_md55"></a>
If this file were big</h3>
<p>Request the file parts in parallel <a href="https://gateway.ipfs.io/ipfs/Qm...1">https://gateway.ipfs.io/ipfs/Qm...1</a> <a href="https://jcsl.hopto.org/ipfs/Qm...2">https://jcsl.hopto.org/ipfs/Qm...2</a> </p><div class="mermaid"> flowchart LR; ipns["/ipns/k51...ett"]--&gt;dnsl["/ipns/ipfs.tech"]--&gt;root["/ipfs/QmR...2SRy"] style ipns fill:#f9f style dnsl fill:#fa9 root["/ipfs/QmR...SRy"] root--&gt;e1["..."] root--&gt;nuxt["_nuxt = QmY...bnT"] root--&gt;e3["..."] root--&gt;index["index.html = QmT...tju"] root--&gt;e5["..."] nuxt--&gt;f1["..."] nuxt--&gt;img["ipfs-logo.a313bcee.svg = QmWTW21hadJGoAcmGZC18mCFq71UUVGPtJSX5PeBubnQCQ"] nuxt--&gt;f2["..."] style root fill:#9fb style index fill:#9fb style nuxt fill:#9fb style img fill:#9fb img--&gt;c0["Qm...1"] img--&gt;c1["Qm...2"] </div><h2><a class="anchor" id="autotoc_md56"></a>
Since the HTTP responses can come from any source...</h2>
<p>Make the same request to multiple gateways in parallel. One will return first, if it passes verification, others are cancelled. Reduces worst-case times.</p>
<p>e.g.:</p>
<ul>
<li><a href="https://ipfs.io/ipfs/QmRE3dyFsbhC1dAthPBvgo4w15dGwppCAybgmJDB5m2SRy?format=raw">https://ipfs.io/ipfs/QmRE3dyFsbhC1dAthPBvgo4w15dGwppCAybgmJDB5m2SRy?format=raw</a></li>
<li><a href="https://dweb.link/ipfs/QmRE3dyFsbhC1dAthPBvgo4w15dGwppCAybgmJDB5m2SRy?format=raw">https://dweb.link/ipfs/QmRE3dyFsbhC1dAthPBvgo4w15dGwppCAybgmJDB5m2SRy?format=raw</a></li>
<li><a href="https://jorropo.net/ipfs/QmRE3dyFsbhC1dAthPBvgo4w15dGwppCAybgmJDB5m2SRy?format=raw">https://jorropo.net/ipfs/QmRE3dyFsbhC1dAthPBvgo4w15dGwppCAybgmJDB5m2SRy?format=raw</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md57"></a>
Possible future considerations</h2>
<ul>
<li>Design &amp; implementation changes necessary for upstreaming</li>
<li>User configuration (e.g. gateways to use &amp; discovery enabled)</li>
<li>IPFS HTTP /routing/v1 API<ul>
<li>Helping with missing data and exhausted known gateways</li>
</ul>
</li>
<li>Partial CAR (Content-addressed Archives) requests<ul>
<li>fewer network round-trips</li>
<li>see <a href="https://specs.ipfs.tech/ipips/ipip-0402/">https://specs.ipfs.tech/ipips/ipip-0402/</a></li>
</ul>
</li>
<li>IPFS-specific DevTools (e.g.: DAG explorer)</li>
<li>Possibly connecting to webtransport IPFS peers</li>
</ul>
<h2><a class="anchor" id="autotoc_md58"></a>
POC Screenshot</h2>
<p><img src="icss.png" alt="ScreenShot" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md59"></a>
Questions &amp; Contact/Further reading</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">what   </th><th class="markdownTableHeadNone">where    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">John's Email   </td><td class="markdownTableBodyNone"><a href="#" onclick="location.href='mai'+'lto:'+'joh'+'n@'+'lit'+'tl'+'ebe'+'ar'+'lab'+'s.'+'io'; return false;">john@<span style="display: none;">.nosp@m.</span>litt<span style="display: none;">.nosp@m.</span>lebea<span style="display: none;">.nosp@m.</span>rlab<span style="display: none;">.nosp@m.</span>s.io</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ChromeStatus Feature   </td><td class="markdownTableBodyNone"><a href="https://chromestatus.com/feature/5105580464668672">https://chromestatus.com/feature/5105580464668672</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Tracking Issue   </td><td class="markdownTableBodyNone"><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1440503">https://bugs.chromium.org/p/chromium/issues/detail?id=1440503</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">POC Repo   </td><td class="markdownTableBodyNone"><a href="https://github.com/little-bear-labs/ipfs-chromium">https://github.com/little-bear-labs/ipfs-chromium</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IPFS Specs   </td><td class="markdownTableBodyNone"><a href="https://specs.ipfs.tech">https://specs.ipfs.tech</a>   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
